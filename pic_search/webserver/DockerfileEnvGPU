#FROM tensorflow/tensorflow:2.20.0-gpu
FROM nvcr.io/nvidia/tensorflow:25.02-tf2-py3

WORKDIR /app/src
COPY ./requirements_no_tf.txt /app/requirements_no_tf.txt

ENV TF_XLA_FLAGS=--tf_xla_cpu_global_jit
COPY ./models/vgg16_weights_tf_dim_ordering_tf_kernels_notop.h5 /app/models/vgg16_weights_tf_dim_ordering_tf_kernels_notop.h5
RUN mkdir -p /root/.keras/models && mv /app/models/* /root/.keras/models/

# Avoid overriding TensorFlow's pinned dependencies (e.g., protobuf) from base image
# Do not upgrade pip and do not use --ignore-installed to prevent breaking TF deps
RUN pip install --no-cache-dir -r /app/requirements_no_tf.txt -i https://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com


# docker build   -t   tensorflow/webserver-env:25.02-tf2-py3-gpu -f ./DockerfileEnvGPU  .