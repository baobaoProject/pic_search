FROM tensorflow/tensorflow:2.20.0

WORKDIR /app/src
COPY ./requirements_no_tf.txt /app/requirements_no_tf.txt

ENV TF_XLA_FLAGS=--tf_xla_cpu_global_jit
COPY ./models/vgg16_weights_tf_dim_ordering_tf_kernels_notop.h5 /app/models/vgg16_weights_tf_dim_ordering_tf_kernels_notop.h5
RUN mkdir -p /root/.keras/models && mv /app/models/* /root/.keras/models/

RUN pip install --upgrade pip
# 从 requirements.txt 中移除 tensorflow，以保留基础镜像中的 GPU 优化版本
# RUN sed '/tensorflow/d' /app/requirements.txt > /app/requirements_no_tf.txt
RUN pip install -r /app/requirements_no_tf.txt -i https://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com


# docker build   -t   tensorflow/webserver-env:2.20.0 -f ./DockerfileEnv  .